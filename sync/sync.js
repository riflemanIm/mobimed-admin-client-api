"use strict";

var _lodash = _interopRequireDefault(require("lodash.merge"));

var _ru = _interopRequireDefault(require("./translations/ru.json"));

var _requestPromise = _interopRequireDefault(require("request-promise"));

var _request = _interopRequireDefault(require("request"));

var _fs = _interopRequireDefault(require("fs"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

console.log(process.argv[2]);

try {
  if (!["ru", "en", "fr"].includes(process.argv[2])) throw new Error("Needed param LANG after name script ");
  if (!["mobimed_site", "mobi_app", "telemedialog", "telemed", "test"].includes(process.argv[3])) throw new Error("Needed param PROJECT_NAME after param LANG");
  const LANG = process.argv[2];
  const PROJECT_NAME = process.argv[3];
  const HOST = "http://localhost:8000";
  const url = `${HOST}/api/translations/download/${LANG}/${PROJECT_NAME}`;
  const urlUpload = `${HOST}/api/translations/import-file`;
  const distFile = `${__dirname}/translations/${LANG}.json`;
  /**  GET REMOTE JSON  */

  (0, _requestPromise.default)({
    url,
    method: "GET",
    json: true
  }).then(remoteJson => {
    /**  MERGE LOCAL AND REMOTE  */
    const mergedJson = (0, _lodash.default)(remoteJson, _ru.default);
    /**  SAVE mergedJson TO LOCAL  */

    return new Promise(function (resolve, reject) {
      _fs.default.writeFile(distFile, JSON.stringify(mergedJson, null, 2), err => {
        if (err) reject(err);else resolve(true);
      });
    });
  }).then(saved => {
    if (saved) {
      setTimeout(() => {
        /** UPLOAD */
        const req = _request.default.put(urlUpload, function (err, resp, body) {
          if (err) {
            console.error("Error!", err.message);
          } else {
            console.log("Result: " + body);
          }
        });

        const form = req.form();
        form.append("filedata", _fs.default.createReadStream(distFile));
        form.append("filename", `${LANG}.json`);
        form.append("account_id", "1");
        form.append("pname", "test");
        form.append("deleteOldKeys", "false");
        form.append("doBackup", "true");
      }, 2000);
    }
  }).catch(err => console.error(err.message));
} catch (e) {
  console.log(e.message);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zeW5jLmpzIl0sIm5hbWVzIjpbImNvbnNvbGUiLCJsb2ciLCJwcm9jZXNzIiwiYXJndiIsImluY2x1ZGVzIiwiRXJyb3IiLCJMQU5HIiwiUFJPSkVDVF9OQU1FIiwiSE9TVCIsInVybCIsInVybFVwbG9hZCIsImRpc3RGaWxlIiwiX19kaXJuYW1lIiwibWV0aG9kIiwianNvbiIsInRoZW4iLCJyZW1vdGVKc29uIiwibWVyZ2VkSnNvbiIsImxvY2FsSnNvbiIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnMiLCJ3cml0ZUZpbGUiLCJKU09OIiwic3RyaW5naWZ5IiwiZXJyIiwic2F2ZWQiLCJzZXRUaW1lb3V0IiwicmVxIiwicmVxdWVzdCIsInB1dCIsInJlc3AiLCJib2R5IiwiZXJyb3IiLCJtZXNzYWdlIiwiZm9ybSIsImFwcGVuZCIsImNyZWF0ZVJlYWRTdHJlYW0iLCJjYXRjaCIsImUiXSwibWFwcGluZ3MiOiI7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFFQUEsT0FBTyxDQUFDQyxHQUFSLENBQVlDLE9BQU8sQ0FBQ0MsSUFBUixDQUFhLENBQWIsQ0FBWjs7QUFFQSxJQUFJO0FBQ0YsTUFBSSxDQUFDLENBQUMsSUFBRCxFQUFPLElBQVAsRUFBYSxJQUFiLEVBQW1CQyxRQUFuQixDQUE0QkYsT0FBTyxDQUFDQyxJQUFSLENBQWEsQ0FBYixDQUE1QixDQUFMLEVBQ0UsTUFBTSxJQUFJRSxLQUFKLENBQVUsc0NBQVYsQ0FBTjtBQUNGLE1BQ0UsQ0FBQyxDQUFDLGNBQUQsRUFBaUIsVUFBakIsRUFBNkIsY0FBN0IsRUFBNkMsU0FBN0MsRUFBd0QsTUFBeEQsRUFBZ0VELFFBQWhFLENBQ0NGLE9BQU8sQ0FBQ0MsSUFBUixDQUFhLENBQWIsQ0FERCxDQURILEVBS0UsTUFBTSxJQUFJRSxLQUFKLENBQVUsNENBQVYsQ0FBTjtBQUVGLFFBQU1DLElBQUksR0FBR0osT0FBTyxDQUFDQyxJQUFSLENBQWEsQ0FBYixDQUFiO0FBQ0EsUUFBTUksWUFBWSxHQUFHTCxPQUFPLENBQUNDLElBQVIsQ0FBYSxDQUFiLENBQXJCO0FBQ0EsUUFBTUssSUFBSSxHQUFHLHVCQUFiO0FBQ0EsUUFBTUMsR0FBRyxHQUFJLEdBQUVELElBQUssOEJBQTZCRixJQUFLLElBQUdDLFlBQWEsRUFBdEU7QUFDQSxRQUFNRyxTQUFTLEdBQUksR0FBRUYsSUFBSywrQkFBMUI7QUFDQSxRQUFNRyxRQUFRLEdBQUksR0FBRUMsU0FBVSxpQkFBZ0JOLElBQUssT0FBbkQ7QUFFQTs7QUFDQSwrQkFBZTtBQUNiRyxJQUFBQSxHQURhO0FBRWJJLElBQUFBLE1BQU0sRUFBRSxLQUZLO0FBR2JDLElBQUFBLElBQUksRUFBRTtBQUhPLEdBQWYsRUFLR0MsSUFMSCxDQUtTQyxVQUFELElBQWdCO0FBQ3BCO0FBQ0EsVUFBTUMsVUFBVSxHQUFHLHFCQUFNRCxVQUFOLEVBQWtCRSxXQUFsQixDQUFuQjtBQUVBOztBQUNBLFdBQU8sSUFBSUMsT0FBSixDQUFZLFVBQVVDLE9BQVYsRUFBbUJDLE1BQW5CLEVBQTJCO0FBQzVDQyxrQkFBR0MsU0FBSCxDQUFhWixRQUFiLEVBQXVCYSxJQUFJLENBQUNDLFNBQUwsQ0FBZVIsVUFBZixFQUEyQixJQUEzQixFQUFpQyxDQUFqQyxDQUF2QixFQUE2RFMsR0FBRCxJQUFTO0FBQ25FLFlBQUlBLEdBQUosRUFBU0wsTUFBTSxDQUFDSyxHQUFELENBQU4sQ0FBVCxLQUNLTixPQUFPLENBQUMsSUFBRCxDQUFQO0FBQ04sT0FIRDtBQUlELEtBTE0sQ0FBUDtBQU1ELEdBaEJILEVBaUJHTCxJQWpCSCxDQWlCU1ksS0FBRCxJQUFXO0FBQ2YsUUFBSUEsS0FBSixFQUFXO0FBQ1RDLE1BQUFBLFVBQVUsQ0FBQyxNQUFNO0FBQ2Y7QUFDQSxjQUFNQyxHQUFHLEdBQUdDLGlCQUFRQyxHQUFSLENBQVlyQixTQUFaLEVBQXVCLFVBQVVnQixHQUFWLEVBQWVNLElBQWYsRUFBcUJDLElBQXJCLEVBQTJCO0FBQzVELGNBQUlQLEdBQUosRUFBUztBQUNQMUIsWUFBQUEsT0FBTyxDQUFDa0MsS0FBUixDQUFjLFFBQWQsRUFBd0JSLEdBQUcsQ0FBQ1MsT0FBNUI7QUFDRCxXQUZELE1BRU87QUFDTG5DLFlBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLGFBQWFnQyxJQUF6QjtBQUNEO0FBQ0YsU0FOVyxDQUFaOztBQU9BLGNBQU1HLElBQUksR0FBR1AsR0FBRyxDQUFDTyxJQUFKLEVBQWI7QUFDQUEsUUFBQUEsSUFBSSxDQUFDQyxNQUFMLENBQVksVUFBWixFQUF3QmYsWUFBR2dCLGdCQUFILENBQW9CM0IsUUFBcEIsQ0FBeEI7QUFDQXlCLFFBQUFBLElBQUksQ0FBQ0MsTUFBTCxDQUFZLFVBQVosRUFBeUIsR0FBRS9CLElBQUssT0FBaEM7QUFDQThCLFFBQUFBLElBQUksQ0FBQ0MsTUFBTCxDQUFZLFlBQVosRUFBMEIsR0FBMUI7QUFDQUQsUUFBQUEsSUFBSSxDQUFDQyxNQUFMLENBQVksT0FBWixFQUFxQixNQUFyQjtBQUNBRCxRQUFBQSxJQUFJLENBQUNDLE1BQUwsQ0FBWSxlQUFaLEVBQTZCLE9BQTdCO0FBQ0FELFFBQUFBLElBQUksQ0FBQ0MsTUFBTCxDQUFZLFVBQVosRUFBd0IsTUFBeEI7QUFDRCxPQWhCUyxFQWdCUCxJQWhCTyxDQUFWO0FBaUJEO0FBQ0YsR0FyQ0gsRUFzQ0dFLEtBdENILENBc0NVYixHQUFELElBQVMxQixPQUFPLENBQUNrQyxLQUFSLENBQWNSLEdBQUcsQ0FBQ1MsT0FBbEIsQ0F0Q2xCO0FBdUNELENBekRELENBeURFLE9BQU9LLENBQVAsRUFBVTtBQUNWeEMsRUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVl1QyxDQUFDLENBQUNMLE9BQWQ7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtZXJnZSBmcm9tIFwibG9kYXNoLm1lcmdlXCI7XG5pbXBvcnQgbG9jYWxKc29uIGZyb20gXCIuL3RyYW5zbGF0aW9ucy9ydS5qc29uXCI7XG5pbXBvcnQgcmVxdWVzdFByb21pc2UgZnJvbSBcInJlcXVlc3QtcHJvbWlzZVwiO1xuaW1wb3J0IHJlcXVlc3QgZnJvbSBcInJlcXVlc3RcIjtcbmltcG9ydCBmcyBmcm9tIFwiZnNcIjtcblxuY29uc29sZS5sb2cocHJvY2Vzcy5hcmd2WzJdKTtcblxudHJ5IHtcbiAgaWYgKCFbXCJydVwiLCBcImVuXCIsIFwiZnJcIl0uaW5jbHVkZXMocHJvY2Vzcy5hcmd2WzJdKSlcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJOZWVkZWQgcGFyYW0gTEFORyBhZnRlciBuYW1lIHNjcmlwdCBcIik7XG4gIGlmIChcbiAgICAhW1wibW9iaW1lZF9zaXRlXCIsIFwibW9iaV9hcHBcIiwgXCJ0ZWxlbWVkaWFsb2dcIiwgXCJ0ZWxlbWVkXCIsIFwidGVzdFwiXS5pbmNsdWRlcyhcbiAgICAgIHByb2Nlc3MuYXJndlszXVxuICAgIClcbiAgKVxuICAgIHRocm93IG5ldyBFcnJvcihcIk5lZWRlZCBwYXJhbSBQUk9KRUNUX05BTUUgYWZ0ZXIgcGFyYW0gTEFOR1wiKTtcblxuICBjb25zdCBMQU5HID0gcHJvY2Vzcy5hcmd2WzJdO1xuICBjb25zdCBQUk9KRUNUX05BTUUgPSBwcm9jZXNzLmFyZ3ZbM107XG4gIGNvbnN0IEhPU1QgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6ODAwMFwiO1xuICBjb25zdCB1cmwgPSBgJHtIT1NUfS9hcGkvdHJhbnNsYXRpb25zL2Rvd25sb2FkLyR7TEFOR30vJHtQUk9KRUNUX05BTUV9YDtcbiAgY29uc3QgdXJsVXBsb2FkID0gYCR7SE9TVH0vYXBpL3RyYW5zbGF0aW9ucy9pbXBvcnQtZmlsZWA7XG4gIGNvbnN0IGRpc3RGaWxlID0gYCR7X19kaXJuYW1lfS90cmFuc2xhdGlvbnMvJHtMQU5HfS5qc29uYDtcblxuICAvKiogIEdFVCBSRU1PVEUgSlNPTiAgKi9cbiAgcmVxdWVzdFByb21pc2Uoe1xuICAgIHVybCxcbiAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAganNvbjogdHJ1ZSxcbiAgfSlcbiAgICAudGhlbigocmVtb3RlSnNvbikgPT4ge1xuICAgICAgLyoqICBNRVJHRSBMT0NBTCBBTkQgUkVNT1RFICAqL1xuICAgICAgY29uc3QgbWVyZ2VkSnNvbiA9IG1lcmdlKHJlbW90ZUpzb24sIGxvY2FsSnNvbik7XG5cbiAgICAgIC8qKiAgU0FWRSBtZXJnZWRKc29uIFRPIExPQ0FMICAqL1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnMud3JpdGVGaWxlKGRpc3RGaWxlLCBKU09OLnN0cmluZ2lmeShtZXJnZWRKc29uLCBudWxsLCAyKSwgKGVycikgPT4ge1xuICAgICAgICAgIGlmIChlcnIpIHJlamVjdChlcnIpO1xuICAgICAgICAgIGVsc2UgcmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KVxuICAgIC50aGVuKChzYXZlZCkgPT4ge1xuICAgICAgaWYgKHNhdmVkKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIC8qKiBVUExPQUQgKi9cbiAgICAgICAgICBjb25zdCByZXEgPSByZXF1ZXN0LnB1dCh1cmxVcGxvYWQsIGZ1bmN0aW9uIChlcnIsIHJlc3AsIGJvZHkpIHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIVwiLCBlcnIubWVzc2FnZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlJlc3VsdDogXCIgKyBib2R5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25zdCBmb3JtID0gcmVxLmZvcm0oKTtcbiAgICAgICAgICBmb3JtLmFwcGVuZChcImZpbGVkYXRhXCIsIGZzLmNyZWF0ZVJlYWRTdHJlYW0oZGlzdEZpbGUpKTtcbiAgICAgICAgICBmb3JtLmFwcGVuZChcImZpbGVuYW1lXCIsIGAke0xBTkd9Lmpzb25gKTtcbiAgICAgICAgICBmb3JtLmFwcGVuZChcImFjY291bnRfaWRcIiwgXCIxXCIpO1xuICAgICAgICAgIGZvcm0uYXBwZW5kKFwicG5hbWVcIiwgXCJ0ZXN0XCIpO1xuICAgICAgICAgIGZvcm0uYXBwZW5kKFwiZGVsZXRlT2xkS2V5c1wiLCBcImZhbHNlXCIpO1xuICAgICAgICAgIGZvcm0uYXBwZW5kKFwiZG9CYWNrdXBcIiwgXCJ0cnVlXCIpO1xuICAgICAgICB9LCAyMDAwKTtcbiAgICAgIH1cbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGVyci5tZXNzYWdlKSk7XG59IGNhdGNoIChlKSB7XG4gIGNvbnNvbGUubG9nKGUubWVzc2FnZSk7XG59XG4iXX0=