"use strict";

var _lodash = _interopRequireDefault(require("lodash.merge"));

var _ru = _interopRequireDefault(require("./translations/ru.json"));

var _requestPromise = _interopRequireDefault(require("request-promise"));

var _request = _interopRequireDefault(require("request"));

var _fs = _interopRequireDefault(require("fs"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const LANG = "ru";
const PROJECT_NAME = "test";
const url = `http://localhost:8000/api/translations/download/${LANG}/${PROJECT_NAME}`;
const urlUpload = "http://localhost:8000/api/translations/import-file";
const distFile = `${__dirname}/translations/${LANG}.json`;
/**  GET REMOTE JSON  */

(0, _requestPromise.default)({
  url,
  method: "GET",
  json: true
}).then(remoteJson => {
  /**  MERGE LOCAL AND REMOTE  */
  const mergedJson = (0, _lodash.default)(remoteJson, _ru.default);
  /**  SAVE mergedJson TO LOCAL  */

  return new Promise(function (resolve, reject) {
    _fs.default.writeFile(distFile, JSON.stringify(mergedJson, null, 2), err => {
      if (err) reject(err);else resolve(true);
    });
  });
}).then(saved => {
  if (saved) {
    setTimeout(() => {
      /** UPLOAD */
      const req = _request.default.put(urlUpload, function (err, resp, body) {
        if (err) {
          console.error("Error!", err.message);
        } else {
          console.log("Result: " + body);
        }
      });

      const form = req.form();
      form.append("filedata", _fs.default.createReadStream(distFile));
      form.append("filename", `${LANG}.json`);
      form.append("account_id", "1");
      form.append("pname", "test");
      form.append("deleteOldKeys", "false");
      form.append("doBackup", "true");
    }, 2000);
  }
}).catch(err => console.error(err.message));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zeW5jLmpzIl0sIm5hbWVzIjpbIkxBTkciLCJQUk9KRUNUX05BTUUiLCJ1cmwiLCJ1cmxVcGxvYWQiLCJkaXN0RmlsZSIsIl9fZGlybmFtZSIsIm1ldGhvZCIsImpzb24iLCJ0aGVuIiwicmVtb3RlSnNvbiIsIm1lcmdlZEpzb24iLCJsb2NhbEpzb24iLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImZzIiwid3JpdGVGaWxlIiwiSlNPTiIsInN0cmluZ2lmeSIsImVyciIsInNhdmVkIiwic2V0VGltZW91dCIsInJlcSIsInJlcXVlc3QiLCJwdXQiLCJyZXNwIiwiYm9keSIsImNvbnNvbGUiLCJlcnJvciIsIm1lc3NhZ2UiLCJsb2ciLCJmb3JtIiwiYXBwZW5kIiwiY3JlYXRlUmVhZFN0cmVhbSIsImNhdGNoIl0sIm1hcHBpbmdzIjoiOztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUEsTUFBTUEsSUFBSSxHQUFHLElBQWI7QUFDQSxNQUFNQyxZQUFZLEdBQUcsTUFBckI7QUFDQSxNQUFNQyxHQUFHLEdBQUksbURBQWtERixJQUFLLElBQUdDLFlBQWEsRUFBcEY7QUFDQSxNQUFNRSxTQUFTLEdBQUcsb0RBQWxCO0FBQ0EsTUFBTUMsUUFBUSxHQUFJLEdBQUVDLFNBQVUsaUJBQWdCTCxJQUFLLE9BQW5EO0FBRUE7O0FBQ0EsNkJBQWU7QUFDYkUsRUFBQUEsR0FEYTtBQUViSSxFQUFBQSxNQUFNLEVBQUUsS0FGSztBQUdiQyxFQUFBQSxJQUFJLEVBQUU7QUFITyxDQUFmLEVBS0dDLElBTEgsQ0FLU0MsVUFBRCxJQUFnQjtBQUNwQjtBQUNBLFFBQU1DLFVBQVUsR0FBRyxxQkFBTUQsVUFBTixFQUFrQkUsV0FBbEIsQ0FBbkI7QUFFQTs7QUFDQSxTQUFPLElBQUlDLE9BQUosQ0FBWSxVQUFVQyxPQUFWLEVBQW1CQyxNQUFuQixFQUEyQjtBQUM1Q0MsZ0JBQUdDLFNBQUgsQ0FBYVosUUFBYixFQUF1QmEsSUFBSSxDQUFDQyxTQUFMLENBQWVSLFVBQWYsRUFBMkIsSUFBM0IsRUFBaUMsQ0FBakMsQ0FBdkIsRUFBNkRTLEdBQUQsSUFBUztBQUNuRSxVQUFJQSxHQUFKLEVBQVNMLE1BQU0sQ0FBQ0ssR0FBRCxDQUFOLENBQVQsS0FDS04sT0FBTyxDQUFDLElBQUQsQ0FBUDtBQUNOLEtBSEQ7QUFJRCxHQUxNLENBQVA7QUFNRCxDQWhCSCxFQWlCR0wsSUFqQkgsQ0FpQlNZLEtBQUQsSUFBVztBQUNmLE1BQUlBLEtBQUosRUFBVztBQUNUQyxJQUFBQSxVQUFVLENBQUMsTUFBTTtBQUNmO0FBQ0EsWUFBTUMsR0FBRyxHQUFHQyxpQkFBUUMsR0FBUixDQUFZckIsU0FBWixFQUF1QixVQUFVZ0IsR0FBVixFQUFlTSxJQUFmLEVBQXFCQyxJQUFyQixFQUEyQjtBQUM1RCxZQUFJUCxHQUFKLEVBQVM7QUFDUFEsVUFBQUEsT0FBTyxDQUFDQyxLQUFSLENBQWMsUUFBZCxFQUF3QlQsR0FBRyxDQUFDVSxPQUE1QjtBQUNELFNBRkQsTUFFTztBQUNMRixVQUFBQSxPQUFPLENBQUNHLEdBQVIsQ0FBWSxhQUFhSixJQUF6QjtBQUNEO0FBQ0YsT0FOVyxDQUFaOztBQU9BLFlBQU1LLElBQUksR0FBR1QsR0FBRyxDQUFDUyxJQUFKLEVBQWI7QUFDQUEsTUFBQUEsSUFBSSxDQUFDQyxNQUFMLENBQVksVUFBWixFQUF3QmpCLFlBQUdrQixnQkFBSCxDQUFvQjdCLFFBQXBCLENBQXhCO0FBQ0EyQixNQUFBQSxJQUFJLENBQUNDLE1BQUwsQ0FBWSxVQUFaLEVBQXlCLEdBQUVoQyxJQUFLLE9BQWhDO0FBQ0ErQixNQUFBQSxJQUFJLENBQUNDLE1BQUwsQ0FBWSxZQUFaLEVBQTBCLEdBQTFCO0FBQ0FELE1BQUFBLElBQUksQ0FBQ0MsTUFBTCxDQUFZLE9BQVosRUFBcUIsTUFBckI7QUFDQUQsTUFBQUEsSUFBSSxDQUFDQyxNQUFMLENBQVksZUFBWixFQUE2QixPQUE3QjtBQUNBRCxNQUFBQSxJQUFJLENBQUNDLE1BQUwsQ0FBWSxVQUFaLEVBQXdCLE1BQXhCO0FBQ0QsS0FoQlMsRUFnQlAsSUFoQk8sQ0FBVjtBQWlCRDtBQUNGLENBckNILEVBc0NHRSxLQXRDSCxDQXNDVWYsR0FBRCxJQUFTUSxPQUFPLENBQUNDLEtBQVIsQ0FBY1QsR0FBRyxDQUFDVSxPQUFsQixDQXRDbEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbWVyZ2UgZnJvbSBcImxvZGFzaC5tZXJnZVwiO1xuaW1wb3J0IGxvY2FsSnNvbiBmcm9tIFwiLi90cmFuc2xhdGlvbnMvcnUuanNvblwiO1xuaW1wb3J0IHJlcXVlc3RQcm9taXNlIGZyb20gXCJyZXF1ZXN0LXByb21pc2VcIjtcbmltcG9ydCByZXF1ZXN0IGZyb20gXCJyZXF1ZXN0XCI7XG5pbXBvcnQgZnMgZnJvbSBcImZzXCI7XG5cbmNvbnN0IExBTkcgPSBcInJ1XCI7XG5jb25zdCBQUk9KRUNUX05BTUUgPSBcInRlc3RcIjtcbmNvbnN0IHVybCA9IGBodHRwOi8vbG9jYWxob3N0OjgwMDAvYXBpL3RyYW5zbGF0aW9ucy9kb3dubG9hZC8ke0xBTkd9LyR7UFJPSkVDVF9OQU1FfWA7XG5jb25zdCB1cmxVcGxvYWQgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6ODAwMC9hcGkvdHJhbnNsYXRpb25zL2ltcG9ydC1maWxlXCI7XG5jb25zdCBkaXN0RmlsZSA9IGAke19fZGlybmFtZX0vdHJhbnNsYXRpb25zLyR7TEFOR30uanNvbmA7XG5cbi8qKiAgR0VUIFJFTU9URSBKU09OICAqL1xucmVxdWVzdFByb21pc2Uoe1xuICB1cmwsXG4gIG1ldGhvZDogXCJHRVRcIixcbiAganNvbjogdHJ1ZSxcbn0pXG4gIC50aGVuKChyZW1vdGVKc29uKSA9PiB7XG4gICAgLyoqICBNRVJHRSBMT0NBTCBBTkQgUkVNT1RFICAqL1xuICAgIGNvbnN0IG1lcmdlZEpzb24gPSBtZXJnZShyZW1vdGVKc29uLCBsb2NhbEpzb24pO1xuXG4gICAgLyoqICBTQVZFIG1lcmdlZEpzb24gVE8gTE9DQUwgICovXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIGZzLndyaXRlRmlsZShkaXN0RmlsZSwgSlNPTi5zdHJpbmdpZnkobWVyZ2VkSnNvbiwgbnVsbCwgMiksIChlcnIpID0+IHtcbiAgICAgICAgaWYgKGVycikgcmVqZWN0KGVycik7XG4gICAgICAgIGVsc2UgcmVzb2x2ZSh0cnVlKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KVxuICAudGhlbigoc2F2ZWQpID0+IHtcbiAgICBpZiAoc2F2ZWQpIHtcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAvKiogVVBMT0FEICovXG4gICAgICAgIGNvbnN0IHJlcSA9IHJlcXVlc3QucHV0KHVybFVwbG9hZCwgZnVuY3Rpb24gKGVyciwgcmVzcCwgYm9keSkge1xuICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciFcIiwgZXJyLm1lc3NhZ2UpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlJlc3VsdDogXCIgKyBib2R5KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBmb3JtID0gcmVxLmZvcm0oKTtcbiAgICAgICAgZm9ybS5hcHBlbmQoXCJmaWxlZGF0YVwiLCBmcy5jcmVhdGVSZWFkU3RyZWFtKGRpc3RGaWxlKSk7XG4gICAgICAgIGZvcm0uYXBwZW5kKFwiZmlsZW5hbWVcIiwgYCR7TEFOR30uanNvbmApO1xuICAgICAgICBmb3JtLmFwcGVuZChcImFjY291bnRfaWRcIiwgXCIxXCIpO1xuICAgICAgICBmb3JtLmFwcGVuZChcInBuYW1lXCIsIFwidGVzdFwiKTtcbiAgICAgICAgZm9ybS5hcHBlbmQoXCJkZWxldGVPbGRLZXlzXCIsIFwiZmFsc2VcIik7XG4gICAgICAgIGZvcm0uYXBwZW5kKFwiZG9CYWNrdXBcIiwgXCJ0cnVlXCIpO1xuICAgICAgfSwgMjAwMCk7XG4gICAgfVxuICB9KVxuICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihlcnIubWVzc2FnZSkpO1xuIl19