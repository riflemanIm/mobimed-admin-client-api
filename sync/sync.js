"use strict";

var _lodash = _interopRequireDefault(require("lodash.merge"));

var _ru = _interopRequireDefault(require("./translations/ru.json"));

var _requestPromise = _interopRequireDefault(require("request-promise"));

var _request = _interopRequireDefault(require("request"));

var _fs = _interopRequireDefault(require("fs"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

try {
  /** ================ CHECK process.argv ================ */
  if (!["ru", "en", "fr"].includes(process.argv[2])) throw new Error("Needed param LANG after name script ");
  if (!["mobimed_site", "mobi_app", "telemedialog", "telemed", "test"].includes(process.argv[3])) throw new Error("Needed param PROJECT_NAME after param LANG");
  /** ================ CONSTs ================ */

  const LANG = process.argv[2];
  const PROJECT_NAME = process.argv[3];
  const HOST = "http://localhost:8000";
  const url = `${HOST}/api/translations/download/${LANG}/${PROJECT_NAME}`;
  const urlUpload = `${HOST}/api/translations/import-file`;
  const distFile = `${__dirname}/translations/${LANG}.json`;
  /** ================ CHECK Destination file ================ */

  if (!_fs.default.existsSync(distFile)) {
    throw new Error("Destination file not exists");
  }
  /** ================ GET REMOTE JSON ================ */


  (0, _requestPromise.default)({
    url,
    method: "GET",
    json: true
  }).then(remoteJson => {
    /** ================ MERGE LOCAL AND REMOTE ================ */
    const mergedJson = (0, _lodash.default)(remoteJson, _ru.default);
    /** ================ SAVE mergedJson TO LOCAL ================ */

    return new Promise(function (resolve, reject) {
      _fs.default.writeFile(distFile, JSON.stringify(mergedJson, null, 2), err => {
        if (err) reject(err);else resolve(true);
      });
    });
  }).then(saved => {
    if (saved) {
      setTimeout(() => {
        /** ================ UPLOAD ================*/
        const req = _request.default.put(urlUpload, function (err, resp, body) {
          if (err) {
            console.error("Error!", err.message);
          } else {
            console.log("Result: " + body);
          }
        });

        const form = req.form();
        form.append("filedata", _fs.default.createReadStream(distFile));
        form.append("filename", `${LANG}.json`);
        form.append("account_id", "1");
        form.append("pname", "test");
        form.append("deleteOldKeys", "false");
        form.append("doBackup", "true");
      }, 2000);
    }
  }).catch(err => console.error(err.message));
} catch (e) {
  console.log(e.message);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zeW5jLmpzIl0sIm5hbWVzIjpbImluY2x1ZGVzIiwicHJvY2VzcyIsImFyZ3YiLCJFcnJvciIsIkxBTkciLCJQUk9KRUNUX05BTUUiLCJIT1NUIiwidXJsIiwidXJsVXBsb2FkIiwiZGlzdEZpbGUiLCJfX2Rpcm5hbWUiLCJmcyIsImV4aXN0c1N5bmMiLCJtZXRob2QiLCJqc29uIiwidGhlbiIsInJlbW90ZUpzb24iLCJtZXJnZWRKc29uIiwibG9jYWxKc29uIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJ3cml0ZUZpbGUiLCJKU09OIiwic3RyaW5naWZ5IiwiZXJyIiwic2F2ZWQiLCJzZXRUaW1lb3V0IiwicmVxIiwicmVxdWVzdCIsInB1dCIsInJlc3AiLCJib2R5IiwiY29uc29sZSIsImVycm9yIiwibWVzc2FnZSIsImxvZyIsImZvcm0iLCJhcHBlbmQiLCJjcmVhdGVSZWFkU3RyZWFtIiwiY2F0Y2giLCJlIl0sIm1hcHBpbmdzIjoiOztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUEsSUFBSTtBQUNGO0FBQ0EsTUFBSSxDQUFDLENBQUMsSUFBRCxFQUFPLElBQVAsRUFBYSxJQUFiLEVBQW1CQSxRQUFuQixDQUE0QkMsT0FBTyxDQUFDQyxJQUFSLENBQWEsQ0FBYixDQUE1QixDQUFMLEVBQ0UsTUFBTSxJQUFJQyxLQUFKLENBQVUsc0NBQVYsQ0FBTjtBQUNGLE1BQ0UsQ0FBQyxDQUFDLGNBQUQsRUFBaUIsVUFBakIsRUFBNkIsY0FBN0IsRUFBNkMsU0FBN0MsRUFBd0QsTUFBeEQsRUFBZ0VILFFBQWhFLENBQ0NDLE9BQU8sQ0FBQ0MsSUFBUixDQUFhLENBQWIsQ0FERCxDQURILEVBS0UsTUFBTSxJQUFJQyxLQUFKLENBQVUsNENBQVYsQ0FBTjtBQUNGOztBQUNBLFFBQU1DLElBQUksR0FBR0gsT0FBTyxDQUFDQyxJQUFSLENBQWEsQ0FBYixDQUFiO0FBQ0EsUUFBTUcsWUFBWSxHQUFHSixPQUFPLENBQUNDLElBQVIsQ0FBYSxDQUFiLENBQXJCO0FBQ0EsUUFBTUksSUFBSSxHQUFHLHVCQUFiO0FBQ0EsUUFBTUMsR0FBRyxHQUFJLEdBQUVELElBQUssOEJBQTZCRixJQUFLLElBQUdDLFlBQWEsRUFBdEU7QUFDQSxRQUFNRyxTQUFTLEdBQUksR0FBRUYsSUFBSywrQkFBMUI7QUFDQSxRQUFNRyxRQUFRLEdBQUksR0FBRUMsU0FBVSxpQkFBZ0JOLElBQUssT0FBbkQ7QUFFQTs7QUFDQSxNQUFJLENBQUNPLFlBQUdDLFVBQUgsQ0FBY0gsUUFBZCxDQUFMLEVBQThCO0FBQzVCLFVBQU0sSUFBSU4sS0FBSixDQUFVLDZCQUFWLENBQU47QUFDRDtBQUVEOzs7QUFDQSwrQkFBZTtBQUNiSSxJQUFBQSxHQURhO0FBRWJNLElBQUFBLE1BQU0sRUFBRSxLQUZLO0FBR2JDLElBQUFBLElBQUksRUFBRTtBQUhPLEdBQWYsRUFLR0MsSUFMSCxDQUtTQyxVQUFELElBQWdCO0FBQ3BCO0FBQ0EsVUFBTUMsVUFBVSxHQUFHLHFCQUFNRCxVQUFOLEVBQWtCRSxXQUFsQixDQUFuQjtBQUVBOztBQUNBLFdBQU8sSUFBSUMsT0FBSixDQUFZLFVBQVVDLE9BQVYsRUFBbUJDLE1BQW5CLEVBQTJCO0FBQzVDVixrQkFBR1csU0FBSCxDQUFhYixRQUFiLEVBQXVCYyxJQUFJLENBQUNDLFNBQUwsQ0FBZVAsVUFBZixFQUEyQixJQUEzQixFQUFpQyxDQUFqQyxDQUF2QixFQUE2RFEsR0FBRCxJQUFTO0FBQ25FLFlBQUlBLEdBQUosRUFBU0osTUFBTSxDQUFDSSxHQUFELENBQU4sQ0FBVCxLQUNLTCxPQUFPLENBQUMsSUFBRCxDQUFQO0FBQ04sT0FIRDtBQUlELEtBTE0sQ0FBUDtBQU1ELEdBaEJILEVBaUJHTCxJQWpCSCxDQWlCU1csS0FBRCxJQUFXO0FBQ2YsUUFBSUEsS0FBSixFQUFXO0FBQ1RDLE1BQUFBLFVBQVUsQ0FBQyxNQUFNO0FBQ2Y7QUFDQSxjQUFNQyxHQUFHLEdBQUdDLGlCQUFRQyxHQUFSLENBQVl0QixTQUFaLEVBQXVCLFVBQVVpQixHQUFWLEVBQWVNLElBQWYsRUFBcUJDLElBQXJCLEVBQTJCO0FBQzVELGNBQUlQLEdBQUosRUFBUztBQUNQUSxZQUFBQSxPQUFPLENBQUNDLEtBQVIsQ0FBYyxRQUFkLEVBQXdCVCxHQUFHLENBQUNVLE9BQTVCO0FBQ0QsV0FGRCxNQUVPO0FBQ0xGLFlBQUFBLE9BQU8sQ0FBQ0csR0FBUixDQUFZLGFBQWFKLElBQXpCO0FBQ0Q7QUFDRixTQU5XLENBQVo7O0FBT0EsY0FBTUssSUFBSSxHQUFHVCxHQUFHLENBQUNTLElBQUosRUFBYjtBQUNBQSxRQUFBQSxJQUFJLENBQUNDLE1BQUwsQ0FBWSxVQUFaLEVBQXdCM0IsWUFBRzRCLGdCQUFILENBQW9COUIsUUFBcEIsQ0FBeEI7QUFDQTRCLFFBQUFBLElBQUksQ0FBQ0MsTUFBTCxDQUFZLFVBQVosRUFBeUIsR0FBRWxDLElBQUssT0FBaEM7QUFDQWlDLFFBQUFBLElBQUksQ0FBQ0MsTUFBTCxDQUFZLFlBQVosRUFBMEIsR0FBMUI7QUFDQUQsUUFBQUEsSUFBSSxDQUFDQyxNQUFMLENBQVksT0FBWixFQUFxQixNQUFyQjtBQUNBRCxRQUFBQSxJQUFJLENBQUNDLE1BQUwsQ0FBWSxlQUFaLEVBQTZCLE9BQTdCO0FBQ0FELFFBQUFBLElBQUksQ0FBQ0MsTUFBTCxDQUFZLFVBQVosRUFBd0IsTUFBeEI7QUFDRCxPQWhCUyxFQWdCUCxJQWhCTyxDQUFWO0FBaUJEO0FBQ0YsR0FyQ0gsRUFzQ0dFLEtBdENILENBc0NVZixHQUFELElBQVNRLE9BQU8sQ0FBQ0MsS0FBUixDQUFjVCxHQUFHLENBQUNVLE9BQWxCLENBdENsQjtBQXVDRCxDQS9ERCxDQStERSxPQUFPTSxDQUFQLEVBQVU7QUFDVlIsRUFBQUEsT0FBTyxDQUFDRyxHQUFSLENBQVlLLENBQUMsQ0FBQ04sT0FBZDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1lcmdlIGZyb20gXCJsb2Rhc2gubWVyZ2VcIjtcbmltcG9ydCBsb2NhbEpzb24gZnJvbSBcIi4vdHJhbnNsYXRpb25zL3J1Lmpzb25cIjtcbmltcG9ydCByZXF1ZXN0UHJvbWlzZSBmcm9tIFwicmVxdWVzdC1wcm9taXNlXCI7XG5pbXBvcnQgcmVxdWVzdCBmcm9tIFwicmVxdWVzdFwiO1xuaW1wb3J0IGZzIGZyb20gXCJmc1wiO1xuXG50cnkge1xuICAvKiogPT09PT09PT09PT09PT09PSBDSEVDSyBwcm9jZXNzLmFyZ3YgPT09PT09PT09PT09PT09PSAqL1xuICBpZiAoIVtcInJ1XCIsIFwiZW5cIiwgXCJmclwiXS5pbmNsdWRlcyhwcm9jZXNzLmFyZ3ZbMl0pKVxuICAgIHRocm93IG5ldyBFcnJvcihcIk5lZWRlZCBwYXJhbSBMQU5HIGFmdGVyIG5hbWUgc2NyaXB0IFwiKTtcbiAgaWYgKFxuICAgICFbXCJtb2JpbWVkX3NpdGVcIiwgXCJtb2JpX2FwcFwiLCBcInRlbGVtZWRpYWxvZ1wiLCBcInRlbGVtZWRcIiwgXCJ0ZXN0XCJdLmluY2x1ZGVzKFxuICAgICAgcHJvY2Vzcy5hcmd2WzNdXG4gICAgKVxuICApXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiTmVlZGVkIHBhcmFtIFBST0pFQ1RfTkFNRSBhZnRlciBwYXJhbSBMQU5HXCIpO1xuICAvKiogPT09PT09PT09PT09PT09PSBDT05TVHMgPT09PT09PT09PT09PT09PSAqL1xuICBjb25zdCBMQU5HID0gcHJvY2Vzcy5hcmd2WzJdO1xuICBjb25zdCBQUk9KRUNUX05BTUUgPSBwcm9jZXNzLmFyZ3ZbM107XG4gIGNvbnN0IEhPU1QgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6ODAwMFwiO1xuICBjb25zdCB1cmwgPSBgJHtIT1NUfS9hcGkvdHJhbnNsYXRpb25zL2Rvd25sb2FkLyR7TEFOR30vJHtQUk9KRUNUX05BTUV9YDtcbiAgY29uc3QgdXJsVXBsb2FkID0gYCR7SE9TVH0vYXBpL3RyYW5zbGF0aW9ucy9pbXBvcnQtZmlsZWA7XG4gIGNvbnN0IGRpc3RGaWxlID0gYCR7X19kaXJuYW1lfS90cmFuc2xhdGlvbnMvJHtMQU5HfS5qc29uYDtcblxuICAvKiogPT09PT09PT09PT09PT09PSBDSEVDSyBEZXN0aW5hdGlvbiBmaWxlID09PT09PT09PT09PT09PT0gKi9cbiAgaWYgKCFmcy5leGlzdHNTeW5jKGRpc3RGaWxlKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkRlc3RpbmF0aW9uIGZpbGUgbm90IGV4aXN0c1wiKTtcbiAgfVxuXG4gIC8qKiA9PT09PT09PT09PT09PT09IEdFVCBSRU1PVEUgSlNPTiA9PT09PT09PT09PT09PT09ICovXG4gIHJlcXVlc3RQcm9taXNlKHtcbiAgICB1cmwsXG4gICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgIGpzb246IHRydWUsXG4gIH0pXG4gICAgLnRoZW4oKHJlbW90ZUpzb24pID0+IHtcbiAgICAgIC8qKiA9PT09PT09PT09PT09PT09IE1FUkdFIExPQ0FMIEFORCBSRU1PVEUgPT09PT09PT09PT09PT09PSAqL1xuICAgICAgY29uc3QgbWVyZ2VkSnNvbiA9IG1lcmdlKHJlbW90ZUpzb24sIGxvY2FsSnNvbik7XG5cbiAgICAgIC8qKiA9PT09PT09PT09PT09PT09IFNBVkUgbWVyZ2VkSnNvbiBUTyBMT0NBTCA9PT09PT09PT09PT09PT09ICovXG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBmcy53cml0ZUZpbGUoZGlzdEZpbGUsIEpTT04uc3RyaW5naWZ5KG1lcmdlZEpzb24sIG51bGwsIDIpLCAoZXJyKSA9PiB7XG4gICAgICAgICAgaWYgKGVycikgcmVqZWN0KGVycik7XG4gICAgICAgICAgZWxzZSByZXNvbHZlKHRydWUpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pXG4gICAgLnRoZW4oKHNhdmVkKSA9PiB7XG4gICAgICBpZiAoc2F2ZWQpIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgLyoqID09PT09PT09PT09PT09PT0gVVBMT0FEID09PT09PT09PT09PT09PT0qL1xuICAgICAgICAgIGNvbnN0IHJlcSA9IHJlcXVlc3QucHV0KHVybFVwbG9hZCwgZnVuY3Rpb24gKGVyciwgcmVzcCwgYm9keSkge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IhXCIsIGVyci5tZXNzYWdlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiUmVzdWx0OiBcIiArIGJvZHkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbnN0IGZvcm0gPSByZXEuZm9ybSgpO1xuICAgICAgICAgIGZvcm0uYXBwZW5kKFwiZmlsZWRhdGFcIiwgZnMuY3JlYXRlUmVhZFN0cmVhbShkaXN0RmlsZSkpO1xuICAgICAgICAgIGZvcm0uYXBwZW5kKFwiZmlsZW5hbWVcIiwgYCR7TEFOR30uanNvbmApO1xuICAgICAgICAgIGZvcm0uYXBwZW5kKFwiYWNjb3VudF9pZFwiLCBcIjFcIik7XG4gICAgICAgICAgZm9ybS5hcHBlbmQoXCJwbmFtZVwiLCBcInRlc3RcIik7XG4gICAgICAgICAgZm9ybS5hcHBlbmQoXCJkZWxldGVPbGRLZXlzXCIsIFwiZmFsc2VcIik7XG4gICAgICAgICAgZm9ybS5hcHBlbmQoXCJkb0JhY2t1cFwiLCBcInRydWVcIik7XG4gICAgICAgIH0sIDIwMDApO1xuICAgICAgfVxuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoZXJyLm1lc3NhZ2UpKTtcbn0gY2F0Y2ggKGUpIHtcbiAgY29uc29sZS5sb2coZS5tZXNzYWdlKTtcbn1cbiJdfQ==